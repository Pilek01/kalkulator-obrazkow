<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SENTREX - Kalkulatory Produkcji</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2a2a2a;
            --bg-tertiary: #3a3a3a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --accent: #ff6b35;
            --accent-hover: #ff8555;
            --border: #404040;
            --success: #4caf50;
            --danger: #f44336;
        }

        body.light-mode {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e0e0e0;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --border: #cccccc;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .content-wrapper {
            flex: 1;
        }

        /* Header with Tab Switcher */
        .header {
            background: var(--bg-secondary);
            border-bottom: 3px solid var(--accent);
            padding: 1.5rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent);
        }

        /* Tab Switcher */
        .tab-switcher {
            display: flex;
            gap: 1rem;
            background: var(--bg-tertiary);
            padding: 0.5rem;
            border-radius: 10px;
            border: 2px solid var(--border);
        }

        .tab-button {
            background: transparent;
            color: var(--text-secondary);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab-button:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .tab-button.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }

        .controls-wrapper {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .language-selector {
            display: flex;
            gap: 0.5rem;
            background: var(--bg-tertiary);
            padding: 0.4rem 0.8rem;
            border-radius: 5px;
            border: 2px solid var(--border);
        }

        .lang-flag {
            cursor: pointer;
            font-size: 1.2rem;
            filter: grayscale(1);
            opacity: 0.6;
            transition: all 0.2s;
        }

        .lang-flag:hover {
            filter: grayscale(0);
            opacity: 1;
            transform: scale(1.1);
        }

        .lang-flag.active {
            filter: grayscale(0);
            opacity: 1;
        }

        .theme-toggle {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: var(--accent);
            border-color: var(--accent);
            transform: scale(1.05);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .calculator-card {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border: 2px solid var(--border);
        }

        .calculator-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--accent);
            text-align: center;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 1rem;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 5px;
            color: var(--text-primary);
            font-size: 1.2rem;
            transition: border-color 0.3s;
            text-align: center;
            font-weight: 600;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .result-box {
            background: linear-gradient(135deg, var(--accent) 0%, #ff8555 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            margin: 2rem 0;
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
        }

        .result-label {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .result-value {
            font-size: 4rem;
            font-weight: 900;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .result-unit {
            font-size: 1.5rem;
            opacity: 0.9;
            margin-top: 0.5rem;
        }

        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid var(--accent);
            width: 100%;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,107,53,0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
            border-color: var(--text-secondary);
        }

        .btn-danger {
            background: var(--danger);
            border-color: var(--danger);
        }

        .btn-small {
            width: auto;
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 107, 53, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .history-section {
            margin-top: 3rem;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .history-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        .history-item {
            background: var(--bg-tertiary);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent);
            transition: all 0.3s;
        }

        .history-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(255,107,53,0.3);
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
        }

        .history-item-time {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .history-item-delete {
            background: var(--danger);
            color: white;
            border: none;
            padding: 0.3rem 0.8rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .history-item-delete:hover {
            background: #d32f2f;
            transform: scale(1.05);
        }

        .history-item-data {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 0.8rem;
        }

        .history-data-item {
            color: var(--text-secondary);
        }

        .history-data-item strong {
            color: var(--text-primary);
        }

        .history-result {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent);
            margin-top: 0.5rem;
        }

        .empty-history {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .info-box {
            background: var(--bg-tertiary);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid var(--accent);
        }

        .info-box h3 {
            color: var(--accent);
            margin-bottom: 0.8rem;
        }

        .info-box p {
            color: var(--text-secondary);
            margin: 0.5rem 0;
        }

        /* Rolki App Specific Styles */
        .rolki-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }

        section h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: var(--accent);
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .checkbox-label input[type="checkbox"] {
            width: auto;
            margin-right: 0.5rem;
            cursor: pointer;
            width: 18px;
            height: 18px;
        }

        .help-text {
            display: block;
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .continuation-group {
            background: var(--bg-tertiary);
            padding: 0.75rem;
            border-radius: 8px;
            border: 2px solid var(--border);
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .summary-card {
            background: var(--bg-tertiary);
            padding: 1.25rem;
            border-radius: 10px;
            text-align: center;
            border: 2px solid var(--accent);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .summary-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .summary-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent);
        }

        .rolls-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .rolls-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .empty-message {
            text-align: center;
            color: var(--text-secondary);
            padding: 2rem;
            font-style: italic;
        }

        .roll-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--accent);
            transition: all 0.2s;
            border: 1px solid var(--border);
            animation: slideIn 0.3s ease-out;
        }

        .roll-item:hover {
            background: #3a3a3a;
            transform: translateX(4px);
            box-shadow: 0 2px 4px rgba(255, 107, 53, 0.2);
        }

        .roll-info {
            flex: 1;
        }

        .roll-number {
            font-size: 1rem;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .roll-number-dual {
            margin-bottom: 0.5rem;
        }

        .roll-number-dual .order-number,
        .roll-number-dual .shift-number {
            display: block;
            font-size: 0.95rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .roll-number-dual .order-number {
            color: var(--accent);
        }

        .roll-number-dual .shift-number {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .roll-details {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 0.25rem;
        }

        .roll-detail {
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .roll-detail strong {
            color: var(--accent);
        }

        .roll-time {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .roll-actions {
            margin-left: 1rem;
        }

        .btn-delete {
            background: var(--danger);
            color: white;
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .btn-delete:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        .pallet-container {
            margin-bottom: 2rem;
            background: linear-gradient(135deg, #2a2a2a 0%, #252525 100%);
            border-radius: 12px;
            padding: 1.5rem;
            border: 3px solid var(--accent);
            box-shadow: 0 6px 12px rgba(255, 107, 53, 0.3);
            position: relative;
        }

        .pallet-container:nth-child(even) {
            border-color: #4ecdc4;
            box-shadow: 0 6px 12px rgba(78, 205, 196, 0.3);
        }

        .pallet-container:nth-child(3n) {
            border-color: #ffe66d;
            box-shadow: 0 6px 12px rgba(255, 230, 109, 0.3);
        }

        .pallet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border);
        }

        .pallet-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pallet-container:nth-child(even) .pallet-title {
            color: #4ecdc4;
        }

        .pallet-container:nth-child(3n) .pallet-title {
            color: #ffe66d;
        }

        .pallet-icon {
            font-size: 1.5rem;
        }

        .pallet-summary {
            display: flex;
            gap: 1.5rem;
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        .pallet-stat {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .pallet-stat strong {
            color: var(--text-primary);
        }

        .pallet-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-edit-pallet {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-edit-pallet:hover {
            background: #45b8b0;
            transform: scale(1.05);
        }

        .pallet-rolls {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .pallet-container .roll-item {
            margin-bottom: 0;
            border-left-width: 3px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            border: 2px solid var(--accent);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s;
        }

        .modal-header {
            margin-bottom: 1.5rem;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
        }

        .modal-footer .btn {
            flex: 1;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        footer {
            text-align: center;
            padding: 1.5rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
            opacity: 0.6;
        }

        .rolls-list::-webkit-scrollbar {
            width: 8px;
        }

        .rolls-list::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 10px;
        }

        .rolls-list::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }

        .rolls-list::-webkit-scrollbar-thumb:hover {
            background: var(--accent-hover);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .input-grid {
                grid-template-columns: 1fr;
            }

            .result-value {
                font-size: 3rem;
            }

            .history-item-data {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .tab-switcher {
                width: 100%;
                justify-content: center;
            }

            .tab-button {
                flex: 1;
                padding: 0.75rem 0.5rem;
                font-size: 0.9rem;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .summary-value {
                font-size: 1.75rem;
            }

            .roll-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .roll-actions {
                margin-left: 0;
                margin-top: 0.5rem;
                width: 100%;
            }

            .btn-delete {
                width: 100%;
            }

            /* Rolki form responsive */
            #rolkiTab .form-group input {
                font-size: 1.1rem !important;
                padding: 1rem !important;
            }

            #rolkiTab section > div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
</head>
<body>
    <div class="content-wrapper">
        <div class="header">
            <div class="header-content">
                <div class="title">SENTREX - Kalkulatory Produkcji</div>

                <!-- Tab Switcher -->
                <div class="tab-switcher">
                    <button class="tab-button active" onclick="switchTab('obrazki')">
                        ğŸ“Š Kalkulator ObrazkÃ³w
                    </button>
                    <button class="tab-button" onclick="switchTab('rolki')">
                        ğŸ“¦ Licznik Rolek
                    </button>
                </div>

                <div class="controls-wrapper">
                    <div class="language-selector" id="languageSelectorObrazki">
                        <span onclick="ObrazkiApp.setLanguage('pl')" class="lang-flag" data-lang="pl" title="Polski">ğŸ‡µğŸ‡±</span>
                        <span onclick="ObrazkiApp.setLanguage('ua')" class="lang-flag" data-lang="ua" title="Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°">ğŸ‡ºğŸ‡¦</span>
                        <span onclick="ObrazkiApp.setLanguage('ru')" class="lang-flag" data-lang="ru" title="Ğ ÑƒÑÑĞºĞ¸Ğ¹">ğŸ‡·ğŸ‡º</span>
                    </div>
                    <button class="theme-toggle" onclick="toggleHelpObrazki()" data-translate-title-key="help_button_title" style="font-size: 1rem; padding: 0.5rem 1rem;" id="helpButtonObrazki">
                        <span data-translate-key="help_button">â“ Jak to dziaÅ‚a?</span>
                    </button>
                    <button class="theme-toggle" onclick="toggleTheme()" data-translate-title-key="theme_toggle_title" title="ZmieÅ„ motyw">ğŸŒ“</button>
                </div>
            </div>
        </div>

        <!-- OBRAZKI TAB CONTENT -->
        <div id="obrazkiTab" class="tab-content active">
            <!-- ROZSUWANE INFO -->
            <div id="helpBoxObrazki" class="info-box" style="max-width: 1200px; margin: 1rem auto; padding: 0 1rem; display: none;">
                <div style="background: var(--bg-tertiary); padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--accent);">
                    <h3 style="color: var(--accent); margin-bottom: 0.8rem;" data-translate-key="help_box_title">â„¹ï¸ Jak to dziaÅ‚a?</h3>
                    <p style="color: var(--text-secondary); margin: 0.5rem 0;" data-translate-key="help_meters"><strong>Metry:</strong> DÅ‚ugoÅ›Ä‡ zadrukowanej rolki papieru (np. 6289m)</p>
                    <p style="color: var(--text-secondary); margin: 0.5rem 0;" data-translate-key="help_sleeve"><strong>WaÅ‚ek (Sleeve):</strong> Å›rednica sleeve'a w centymetrach (np. 59cm)</p>
                    <p style="color: var(--text-secondary); margin: 0.5rem 0;" data-translate-key="help_motifs"><strong>IloÅ›Ä‡ motywÃ³w:</strong> Ile obrazkÃ³w mieÅ›ci siÄ™ na jednym sleeve (np. 2)</p>
                    <p style="color: var(--text-secondary); margin: 0.5rem 0;" data-translate-key="help_formula"><strong>WzÃ³r:</strong> ((Metry / WaÅ‚ek) Ã— 100) Ã— IloÅ›Ä‡ motywÃ³w = Liczba obrazkÃ³w</p>
                </div>
            </div>

            <div class="container">
                <div class="calculator-card">
                    <div class="calculator-header" data-translate-key="card_header">Oblicz liczbÄ™ obrazkÃ³w</div>

                    <form id="calculatorFormObrazki" onsubmit="ObrazkiApp.calculate(event)">
                        <!-- KONFIGURACJA W JEDNEJ LINII -->
                        <div style="margin-bottom: 2rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 8px; border: 2px solid var(--border);">
                            <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.8rem; font-weight: 600;" data-translate-key="config_header">
                                âš™ï¸ KONFIGURACJA (ustaw raz na zmianÄ™)
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                                <div class="form-group" style="margin-bottom: 0;">
                                    <label for="walekObrazki" style="font-size: 0.9rem;" data-translate-key="sleeve_label">ğŸ”§ WaÅ‚ek (cm)</label>
                                    <input
                                        type="number"
                                        id="walekObrazki"
                                        name="walek"
                                        step="0.1"
                                        required
                                        data-translate-placeholder-key="sleeve_placeholder"
                                        placeholder="59.0"
                                        style="font-size: 1rem; padding: 0.7rem;">
                                </div>

                                <div class="form-group" style="margin-bottom: 0;">
                                    <label for="motywyObrazki" style="font-size: 0.9rem;" data-translate-key="motifs_label">ğŸ¨ Motywy</label>
                                    <input
                                        type="number"
                                        id="motywyObrazki"
                                        name="motywy"
                                        step="1"
                                        required
                                        data-translate-placeholder-key="motifs_placeholder"
                                        placeholder="2"
                                        min="1"
                                        style="font-size: 1rem; padding: 0.7rem;">
                                </div>

                                <div class="form-group" style="margin-bottom: 0;">
                                    <label for="rolkiObrazki" style="font-size: 0.9rem;" data-translate-key="rolls_label">ğŸ”ª Rolek</label>
                                    <input
                                        type="number"
                                        id="rolkiObrazki"
                                        name="rolki"
                                        step="1"
                                        min="1"
                                        value="1"
                                        data-translate-placeholder-key="rolls_placeholder"
                                        placeholder="1"
                                        style="font-size: 1rem; padding: 0.7rem;">
                                </div>
                            </div>
                        </div>

                        <!-- DUÅ»E POLE - METRY -->
                        <div class="form-group">
                            <label for="metryObrazki" data-translate-key="meters_label">ğŸ“ Metry (m)</label>
                            <input
                                type="number"
                                id="metryObrazki"
                                name="metry"
                                step="0.01"
                                required
                                data-translate-placeholder-key="meters_placeholder"
                                placeholder="6289"
                                autofocus
                                style="font-size: 2.5rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(0, 191, 255, 0.15), rgba(0, 191, 255, 0.05)); border: 3px solid rgba(0, 191, 255, 0.3); font-weight: 700;">
                        </div>

                        <div class="form-group" style="margin-top: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.8rem; cursor: pointer; user-select: none;">
                                <input
                                    type="checkbox"
                                    id="zaokraglajObrazki"
                                    name="zaokraglaj"
                                    style="width: 24px; height: 24px; cursor: pointer; accent-color: var(--accent);">
                                <span style="font-size: 1rem;" data-translate-key="rounding_label">ğŸ“ˆ ZaokrÄ…glaj w gÃ³rÄ™ (min. +100, max. +200)</span>
                            </label>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem; margin-left: 2rem;" data-translate-key="rounding_desc">
                                ZaokrÄ…gla do peÅ‚nej setki dodajÄ…c minimum 100, maksimum 200 obrazkÃ³w
                            </p>
                        </div>

                        <div id="resultBoxObrazki" class="result-box" style="display: none; background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);">
                            <div class="result-label" data-translate-key="result_label_single">Wynik - 1 rolka</div>
                            <div class="result-value" id="resultValueObrazki">0</div>
                            <div class="result-unit" data-translate-key="result_unit">ObrazkÃ³w</div>
                            <div id="resultDetailsObrazki" style="font-size: 1rem; opacity: 0.9; margin-top: 0.8rem;"></div>

                            <!-- MAÅA INFO O ROLKACH -->
                            <div id="resultTotalObrazki" style="margin-top: 1rem; font-size: 0.95rem; opacity: 0.85; display: none;">
                                <span id="resultTotalTextObrazki"></span>
                            </div>

                            <!-- PRZYCISK KOPIUJ -->
                            <button type="button" class="btn" onclick="ObrazkiApp.copyResult(event)" style="margin-top: 1.5rem; background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.4);">
                                <span data-translate-key="copy_button">ğŸ“‹ Skopiuj wynik (format systemu)</span>
                            </button>
                        </div>

                        <button type="submit" class="btn"><span data-translate-key="calculate_button">ğŸ”¢ Oblicz</span></button>
                    </form>
                </div>

                <div class="history-section">
                    <!-- STATYSTYKI -->
                    <div class="calculator-card" style="margin-bottom: 2rem; padding: 1.5rem;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                            <div style="text-align: center;">
                                <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.3rem;" data-translate-key="stats_today">ğŸ“Š IloÅ›Ä‡ obliczeÅ„</div>
                                <div style="font-size: 2rem; font-weight: 700; color: var(--accent);" id="statTodayObrazki">0</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.3rem;" data-translate-key="stats_total_images">ğŸ¯ ÅÄ…cznie obrazkÃ³w</div>
                                <div style="font-size: 2rem; font-weight: 700; color: var(--success);" id="statTotalObrazki">0</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.3rem;" data-translate-key="stats_avg_roll">ğŸ“ Åšrednia rolka</div>
                                <div style="font-size: 2rem; font-weight: 700; color: #00bfff;" id="statAvgObrazki">0 m</div>
                            </div>
                        </div>
                    </div>

                    <div class="history-header">
                        <div class="history-title" data-translate-key="history_title">ğŸ“œ Historia obliczeÅ„</div>
                        <button class="btn btn-danger" onclick="ObrazkiApp.clearHistory()" style="width: auto; padding: 0.6rem 1.2rem;">
                            <span data-translate-key="clear_history_button">ğŸ—‘ï¸ WyczyÅ›Ä‡ historiÄ™</span>
                        </button>
                    </div>

                    <div id="historyContainerObrazki">
                        <div class="empty-history" data-translate-key="empty_history">
                            Brak historii obliczeÅ„. Wykonaj pierwsze obliczenie!
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ROLKI TAB CONTENT -->
        <div id="rolkiTab" class="tab-content">
            <div class="container rolki-container">
                <!-- Formularz dodawania rolek -->
                <section class="add-section">
                    <h2>Dodaj rolki</h2>
                    <form id="addRollFormRolki">
                        <!-- GÅ‚Ã³wne pola w 2 kolumnach -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="weightRolki" style="font-size: 1.1rem;">ğŸ“¦ Waga rolki (kg) *</label>
                                <input
                                    type="number"
                                    id="weightRolki"
                                    step="0.01"
                                    required
                                    placeholder="np. 125.5"
                                    autofocus
                                    style="font-size: 1.3rem; padding: 1.2rem; font-weight: 700;">
                            </div>

                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="imagesRolki" style="font-size: 1.1rem;">ğŸ–¼ï¸ Liczba obrazkÃ³w (opcjonalnie)</label>
                                <input
                                    type="number"
                                    id="imagesRolki"
                                    step="1"
                                    placeholder="np. 1000"
                                    style="font-size: 1.3rem; padding: 1.2rem; font-weight: 700;">
                            </div>
                        </div>

                        <!-- Konfiguracja w jednej linii -->
                        <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 8px; border: 2px solid var(--border);">
                            <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.8rem; font-weight: 600;">
                                âš™ï¸ KONFIGURACJA
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;">
                                <div class="form-group" style="margin-bottom: 0;">
                                    <label for="quantityRolki" style="font-size: 0.95rem;">ğŸ”¢ IloÅ›Ä‡ rolek</label>
                                    <input
                                        type="number"
                                        id="quantityRolki"
                                        value="1"
                                        min="1"
                                        required
                                        style="font-size: 1.1rem; padding: 0.8rem;">
                                </div>

                                <div class="form-group" style="margin-bottom: 0;">
                                    <label for="rollsPerPalletRolki" style="font-size: 0.95rem;">ğŸ“¦ Rolek na paletÄ™</label>
                                    <input
                                        type="number"
                                        id="rollsPerPalletRolki"
                                        value="3"
                                        min="1"
                                        required
                                        style="font-size: 1.1rem; padding: 0.8rem;">
                                </div>
                            </div>
                        </div>

                        <div class="form-group continuation-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="continuationModeRolki">
                                <span>Kontynuacja zlecenia po poprzedniej zmianie</span>
                            </label>
                        </div>

                        <div class="form-group" id="lastRollGroupRolki" style="display: none;">
                            <label for="lastRollNumberRolki">Ostatnia rolka z poprzedniej zmiany</label>
                            <input
                                type="number"
                                id="lastRollNumberRolki"
                                min="0"
                                value="0"
                                placeholder="np. 20">
                            <small class="help-text">Twoje rolki zacznÄ… siÄ™ od tego numeru + 1</small>
                        </div>

                        <button type="submit" class="btn btn-primary">Dodaj</button>
                    </form>
                </section>

                <!-- Podsumowanie -->
                <section class="summary-section">
                    <h2>ğŸ“Š Podsumowanie zmiany</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem;">
                        <div class="summary-card" style="background: linear-gradient(135deg, rgba(255, 107, 53, 0.15), rgba(255, 107, 53, 0.05)); border: 3px solid var(--accent);">
                            <div class="summary-label">ğŸ“¦ Liczba palet</div>
                            <div class="summary-value" id="totalPalletsRolki" style="font-size: 2.5rem;">0</div>
                        </div>
                        <div class="summary-card" style="background: linear-gradient(135deg, rgba(78, 205, 196, 0.15), rgba(78, 205, 196, 0.05)); border: 3px solid #4ecdc4;">
                            <div class="summary-label">ğŸ¯ Liczba rolek</div>
                            <div class="summary-value" id="totalRollsRolki" style="font-size: 2.5rem; color: #4ecdc4;">0</div>
                        </div>
                        <div class="summary-card" style="background: linear-gradient(135deg, rgba(255, 230, 109, 0.15), rgba(255, 230, 109, 0.05)); border: 3px solid #ffe66d;">
                            <div class="summary-label">âš–ï¸ Suma wag (kg)</div>
                            <div class="summary-value" id="totalWeightRolki" style="font-size: 2.5rem; color: #ffe66d;">0</div>
                        </div>
                        <div class="summary-card" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(76, 175, 80, 0.05)); border: 3px solid var(--success);">
                            <div class="summary-label">ğŸ–¼ï¸ Suma obrazkÃ³w</div>
                            <div class="summary-value" id="totalImagesRolki" style="font-size: 2.5rem; color: var(--success);">0</div>
                        </div>
                    </div>
                </section>

                <!-- Lista rolek -->
                <section class="rolls-section">
                    <div class="rolls-header">
                        <h2>ğŸ“‹ Lista rolek na paletach</h2>
                        <button id="clearAllBtnRolki" class="btn btn-danger btn-small" style="display: none;">
                            ğŸ—‘ï¸ WyczyÅ›Ä‡ wszystko
                        </button>
                    </div>
                    <div id="rollsListRolki" class="rolls-list">
                        <p class="empty-message">Brak rolek. Dodaj pierwszÄ… rolkÄ™ powyÅ¼ej.</p>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <footer>
        Made by Kamil Matysek
    </footer>

    <!-- Modal edycji palety -->
    <div id="editPalletModalRolki" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edytuj paletÄ™</h3>
                <p class="subtitle" id="modalPalletInfoRolki"></p>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editRollsPerPalletRolki">Liczba rolek na tej palecie</label>
                    <input
                        type="number"
                        id="editRollsPerPalletRolki"
                        min="1"
                        value="3">
                    <small class="help-text">ZmieÅ„ liczbÄ™ rolek, a pozostaÅ‚e zostanÄ… przesuniÄ™te do nastÄ™pnej palety</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditBtnRolki">Anuluj</button>
                <button class="btn btn-primary" id="saveEditBtnRolki">Zapisz</button>
            </div>
        </div>
    </div>

    <script>
        // =================================================================
        // TAB SWITCHING
        // =================================================================
        let currentTab = 'obrazki';

        function switchTab(tabName) {
            // Hide all tabs
            document.getElementById('obrazkiTab').classList.remove('active');
            document.getElementById('rolkiTab').classList.remove('active');

            // Remove active from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');

            // Add active to clicked button
            event.target.classList.add('active');

            currentTab = tabName;

            // Show/hide language selector based on tab
            if (tabName === 'obrazki') {
                document.getElementById('languageSelectorObrazki').style.display = 'flex';
                document.getElementById('helpButtonObrazki').style.display = 'block';
            } else {
                document.getElementById('languageSelectorObrazki').style.display = 'none';
                document.getElementById('helpButtonObrazki').style.display = 'none';
            }

            // Save current tab
            localStorage.setItem('currentTab', tabName);
        }

        // Load last tab on page load
        function loadCurrentTab() {
            const savedTab = localStorage.getItem('currentTab') || 'obrazki';
            if (savedTab === 'rolki') {
                document.querySelector('.tab-button.active').classList.remove('active');
                document.querySelectorAll('.tab-button')[1].classList.add('active');
                document.getElementById('obrazkiTab').classList.remove('active');
                document.getElementById('rolkiTab').classList.add('active');
                currentTab = 'rolki';
                document.getElementById('languageSelectorObrazki').style.display = 'none';
                document.getElementById('helpButtonObrazki').style.display = 'none';
            }
        }

        // =================================================================
        // THEME TOGGLE (SHARED)
        // =================================================================
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
        }

        function loadTheme() {
            if (localStorage.getItem('theme') === 'light') {
                document.body.classList.add('light-mode');
            }
        }

        // =================================================================
        // OBRAZKI APP
        // =================================================================
        const ObrazkiApp = {
            translations: {
                pl: {
                    page_title: "Kalkulator ObrazkÃ³w - SENTREX",
                    app_title: "ğŸ“Š Kalkulator ObrazkÃ³w - SENTREX v1.0.5",
                    help_button: "â“ Jak to dziaÅ‚a?",
                    help_button_title: "PokaÅ¼ pomoc",
                    theme_toggle_title: "ZmieÅ„ motyw",
                    help_box_title: "â„¹ï¸ Jak to dziaÅ‚a?",
                    help_meters: "<strong>Metry:</strong> DÅ‚ugoÅ›Ä‡ zadrukowanej rolki papieru (np. 6289m)",
                    help_sleeve: "<strong>WaÅ‚ek (Sleeve):</strong> Å›rednica sleeve'a w centymetrach (np. 59cm)",
                    help_motifs: "<strong>IloÅ›Ä‡ motywÃ³w:</strong> Ile obrazkÃ³w mieÅ›ci siÄ™ na jednym sleeve (np. 2)",
                    help_formula: "<strong>WzÃ³r:</strong> ((Metry / WaÅ‚ek) Ã— 100) Ã— IloÅ›Ä‡ motywÃ³w = Liczba obrazkÃ³w",
                    card_header: "Oblicz liczbÄ™ obrazkÃ³w",
                    config_header: "âš™ï¸ KONFIGURACJA (ustaw raz na zmianÄ™)",
                    sleeve_label: "ğŸ”§ WaÅ‚ek (cm)",
                    sleeve_placeholder: "59.0",
                    motifs_label: "ğŸ¨ Motywy",
                    motifs_placeholder: "2",
                    rolls_label: "ğŸ”ª Rolek",
                    rolls_placeholder: "1",
                    meters_label: "ğŸ“ Metry (m)",
                    meters_placeholder: "6289",
                    rounding_label: "ğŸ“ˆ ZaokrÄ…glaj w gÃ³rÄ™ (min. +100, max. +200)",
                    rounding_desc: "ZaokrÄ…gla do peÅ‚nej setki dodajÄ…c minimum 100, maksimum 200 obrazkÃ³w",
                    result_label_single: "Wynik - 1 rolka",
                    result_unit: "ObrazkÃ³w",
                    copy_button: "ğŸ“‹ Skopiuj wynik (format systemu)",
                    calculate_button: "ğŸ”¢ Oblicz",
                    stats_today: "ğŸ“Š IloÅ›Ä‡ obliczeÅ„",
                    stats_total_images: "ğŸ¯ ÅÄ…cznie obrazkÃ³w",
                    stats_avg_roll: "ğŸ“ Åšrednia rolka",
                    history_title: "ğŸ“œ Historia obliczeÅ„",
                    clear_history_button: "ğŸ—‘ï¸ WyczyÅ›Ä‡ historiÄ™",
                    empty_history: "Brak historii obliczeÅ„. Wykonaj pierwsze obliczenie!",
                    history_delete_button: "ğŸ—‘ï¸ UsuÅ„",
                    history_meters: "<strong>Metry:</strong>",
                    history_sleeve: "<strong>WaÅ‚ek:</strong>",
                    history_motifs: "<strong>Motywy:</strong>",
                    history_rolls: "<strong>Rolek:</strong>",
                    history_result_label: "â¡ï¸ Wynik:",
                    history_images_unit_single: "obrazkÃ³w (1 rolka)",
                    history_rounded_from: "ğŸ“ˆ ZaokrÄ…glono z",
                    history_total_label: "ğŸ”ª ÅÄ…cznie:",
                    history_total_images_unit: "obrazkÃ³w",
                    history_total_from_rolls: "rolek",
                    confirm_delete_item: "Czy na pewno chcesz usunÄ…Ä‡ to obliczenie z historii?",
                    alert_history_empty: "Historia jest juÅ¼ pusta!",
                    confirm_clear_history: "Czy na pewno chcesz usunÄ…Ä‡ caÅ‚Ä… historiÄ™ ({count} obliczeÅ„)?",
                    copied_text: "âœ… Skopiowano:",
                    detailed_result_text: "ğŸ“Š DokÅ‚adny wynik: {exact} (+{diff} obrazkÃ³w)",
                    total_result_text: "ğŸ”ª ÅÄ…cznie {rolls} rolek: {total} obrazkÃ³w ({single} Ã— {rolls})",
                    error_invalid_sleeve: "WartoÅ›Ä‡ waÅ‚ka musi byÄ‡ wiÄ™ksza od zera!"
                },
                ua: {
                    page_title: "ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ—Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ - SENTREX",
                    app_title: "ğŸ“Š ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ—Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ - SENTREX v1.0.5",
                    help_button: "â“ Ğ¯Ğº Ñ†Ğµ Ğ¿Ñ€Ğ°Ñ†ÑÑ”?",
                    help_button_title: "ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚Ğ¸ Ğ´Ğ¾Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ñƒ",
                    theme_toggle_title: "Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ Ñ‚ĞµĞ¼Ñƒ",
                    help_box_title: "â„¹ï¸ Ğ¯Ğº Ñ†Ğµ Ğ¿Ñ€Ğ°Ñ†ÑÑ”?",
                    help_meters: "<strong>ĞœĞµÑ‚Ñ€Ğ¸:</strong> Ğ”Ğ¾Ğ²Ğ¶Ğ¸Ğ½Ğ° Ğ´Ñ€ÑƒĞºĞ¾Ğ²Ğ°Ğ½Ğ¾Ğ³Ğ¾ Ñ€ÑƒĞ»Ğ¾Ğ½Ñƒ Ğ¿Ğ°Ğ¿ĞµÑ€Ñƒ (Ğ½Ğ°Ğ¿Ñ€. 6289Ğ¼)",
                    help_sleeve: "<strong>Ğ’Ğ°Ğ»ĞµĞº (Sleeve):</strong> Ğ´Ñ–Ğ°Ğ¼ĞµÑ‚Ñ€ Ğ³Ñ–Ğ»ÑŒĞ·Ğ¸ Ğ² ÑĞ°Ğ½Ñ‚Ğ¸Ğ¼ĞµÑ‚Ñ€Ğ°Ñ… (Ğ½Ğ°Ğ¿Ñ€. 59ÑĞ¼)",
                    help_motifs: "<strong>ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ñ–Ğ²:</strong> Ğ¡ĞºÑ–Ğ»ÑŒĞºĞ¸ Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ Ğ²Ğ¼Ñ–Ñ‰ÑƒÑ”Ñ‚ÑŒÑÑ Ğ½Ğ° Ğ¾Ğ´Ğ½Ñ–Ğ¹ Ğ³Ñ–Ğ»ÑŒĞ·Ñ– (Ğ½Ğ°Ğ¿Ñ€. 2)",
                    help_formula: "<strong>Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°:</strong> ((ĞœĞµÑ‚Ñ€Ğ¸ / Ğ’Ğ°Ğ»ĞµĞº) Ã— 100) Ã— ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ñ–Ğ² = ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ",
                    card_header: "ĞĞ±Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚Ğ¸ ĞºÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ",
                    config_header: "âš™ï¸ ĞšĞĞĞ¤Ğ†Ğ“Ğ£Ğ ĞĞ¦Ğ†Ğ¯ (Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ Ñ€Ğ°Ğ· Ğ½Ğ° Ğ·Ğ¼Ñ–Ğ½Ñƒ)",
                    sleeve_label: "ğŸ”§ Ğ’Ğ°Ğ»ĞµĞº (ÑĞ¼)",
                    sleeve_placeholder: "59.0",
                    motifs_label: "ğŸ¨ ĞœĞ¾Ñ‚Ğ¸Ğ²Ğ¸",
                    motifs_placeholder: "2",
                    rolls_label: "ğŸ”ª Ğ ÑƒĞ»Ğ¾Ğ½Ñ–Ğ²",
                    rolls_placeholder: "1",
                    meters_label: "ğŸ“ ĞœĞµÑ‚Ñ€Ğ¸ (Ğ¼)",
                    meters_placeholder: "6289",
                    rounding_label: "ğŸ“ˆ ĞĞºÑ€ÑƒĞ³Ğ»ÑĞ²Ğ°Ñ‚Ğ¸ Ğ²Ğ³Ğ¾Ñ€Ñƒ (Ğ¼Ñ–Ğ½. +100, Ğ¼Ğ°ĞºÑ. +200)",
                    rounding_desc: "ĞĞºÑ€ÑƒĞ³Ğ»ÑÑ” Ğ´Ğ¾ Ğ¿Ğ¾Ğ²Ğ½Ğ¾Ñ— ÑĞ¾Ñ‚Ğ½Ñ–, Ğ´Ğ¾Ğ´Ğ°ÑÑ‡Ğ¸ Ğ¼Ñ–Ğ½Ñ–Ğ¼ÑƒĞ¼ 100, Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 200 Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ",
                    result_label_single: "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ - 1 Ñ€ÑƒĞ»Ğ¾Ğ½",
                    result_unit: "Ğ—Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ",
                    copy_button: "ğŸ“‹ Ğ¡ĞºĞ¾Ğ¿Ñ–ÑĞ²Ğ°Ñ‚Ğ¸ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ (Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸)",
                    calculate_button: "ğŸ”¢ ĞĞ±Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚Ğ¸",
                    stats_today: "ğŸ“Š ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ¾Ğ±Ñ‡Ğ¸ÑĞ»ĞµĞ½ÑŒ",
                    stats_total_images: "ğŸ¯ Ğ’ÑÑŒĞ¾Ğ³Ğ¾ Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ",
                    stats_avg_roll: "ğŸ“ Ğ¡ĞµÑ€ĞµĞ´Ğ½Ñ–Ğ¹ Ñ€ÑƒĞ»Ğ¾Ğ½",
                    history_title: "ğŸ“œ Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ğ¾Ğ±Ñ‡Ğ¸ÑĞ»ĞµĞ½ÑŒ",
                    clear_history_button: "ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚Ğ¸ Ñ–ÑÑ‚Ğ¾Ñ€Ñ–Ñ",
                    empty_history: "Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ğ¾Ğ±Ñ‡Ğ¸ÑĞ»ĞµĞ½ÑŒ Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ñ. Ğ—Ñ€Ğ¾Ğ±Ñ–Ñ‚ÑŒ Ğ¿ĞµÑ€ÑˆĞµ Ğ¾Ğ±Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ½Ñ!",
                    history_delete_button: "ğŸ—‘ï¸ Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸",
                    history_meters: "<strong>ĞœĞµÑ‚Ñ€Ğ¸:</strong>",
                    history_sleeve: "<strong>Ğ’Ğ°Ğ»ĞµĞº:</strong>",
                    history_motifs: "<strong>ĞœĞ¾Ñ‚Ğ¸Ğ²Ğ¸:</strong>",
                    history_rolls: "<strong>Ğ ÑƒĞ»Ğ¾Ğ½Ñ–Ğ²:</strong>",
                    history_result_label: "â¡ï¸ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:",
                    history_images_unit_single: "Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ (1 Ñ€ÑƒĞ»Ğ¾Ğ½)",
                    history_rounded_from: "ğŸ“ˆ ĞĞºÑ€ÑƒĞ³Ğ»ĞµĞ½Ğ¾ Ğ·",
                    history_total_label: "ğŸ”ª Ğ’ÑÑŒĞ¾Ğ³Ğ¾:",
                    history_total_images_unit: "Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ",
                    history_total_from_rolls: "Ñ€ÑƒĞ»Ğ¾Ğ½Ñ–Ğ²",
                    confirm_delete_item: "Ğ’Ğ¸ Ğ²Ğ¿ĞµĞ²Ğ½ĞµĞ½Ñ–, Ñ‰Ğ¾ Ñ…Ğ¾Ñ‡ĞµÑ‚Ğµ Ğ²Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ Ñ†Ğµ Ğ¾Ğ±Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ½Ñ Ğ· Ñ–ÑÑ‚Ğ¾Ñ€Ñ–Ñ—?",
                    alert_history_empty: "Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ğ²Ğ¶Ğµ Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ñ!",
                    confirm_clear_history: "Ğ’Ğ¸ Ğ²Ğ¿ĞµĞ²Ğ½ĞµĞ½Ñ–, Ñ‰Ğ¾ Ñ…Ğ¾Ñ‡ĞµÑ‚Ğµ Ğ²Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ Ğ²ÑÑ Ñ–ÑÑ‚Ğ¾Ñ€Ñ–Ñ ({count} Ğ¾Ğ±Ñ‡Ğ¸ÑĞ»ĞµĞ½ÑŒ)?",
                    copied_text: "âœ… Ğ¡ĞºĞ¾Ğ¿Ñ–Ğ¹Ğ¾Ğ²Ğ°Ğ½Ğ¾:",
                    detailed_result_text: "ğŸ“Š Ğ¢Ğ¾Ñ‡Ğ½Ğ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: {exact} (+{diff} Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ)",
                    total_result_text: "ğŸ”ª Ğ’ÑÑŒĞ¾Ğ³Ğ¾ {rolls} Ñ€ÑƒĞ»Ğ¾Ğ½Ñ–Ğ²: {total} Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ ({single} Ã— {rolls})",
                    error_invalid_sleeve: "Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ğ²Ğ°Ğ»Ñƒ Ğ¼Ğ°Ñ” Ğ±ÑƒÑ‚Ğ¸ Ğ±Ñ–Ğ»ÑŒÑˆĞµ Ğ½ÑƒĞ»Ñ!"
                },
                ru: {
                    page_title: "ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ - SENTREX",
                    app_title: "ğŸ“Š ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ - SENTREX v1.0.5",
                    help_button: "â“ ĞšĞ°Ğº ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚?",
                    help_button_title: "ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ",
                    theme_toggle_title: "Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞ¼Ñƒ",
                    help_box_title: "â„¹ï¸ ĞšĞ°Ğº ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚?",
                    help_meters: "<strong>ĞœĞµÑ‚Ñ€Ñ‹:</strong> Ğ”Ğ»Ğ¸Ğ½Ğ° Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ½Ğ¾Ğ³Ğ¾ Ñ€ÑƒĞ»Ğ¾Ğ½Ğ° Ğ±ÑƒĞ¼Ğ°Ğ³Ğ¸ (Ğ½Ğ°Ğ¿Ñ€. 6289Ğ¼)",
                    help_sleeve: "<strong>Ğ’Ğ°Ğ» (Sleeve):</strong> Ğ´Ğ¸Ğ°Ğ¼ĞµÑ‚Ñ€ Ğ³Ğ¸Ğ»ÑŒĞ·Ñ‹ Ğ² ÑĞ°Ğ½Ñ‚Ğ¸Ğ¼ĞµÑ‚Ñ€Ğ°Ñ… (Ğ½Ğ°Ğ¿Ñ€. 59ÑĞ¼)",
                    help_motifs: "<strong>ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ¾Ğ²:</strong> Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾Ğ¼ĞµÑ‰Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ³Ğ¸Ğ»ÑŒĞ·Ğµ (Ğ½Ğ°Ğ¿Ñ€. 2)",
                    help_formula: "<strong>Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°:</strong> ((ĞœĞµÑ‚Ñ€Ñ‹ / Ğ’Ğ°Ğ») Ã— 100) Ã— ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ¾Ğ² = ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹",
                    card_header: "Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹",
                    config_header: "âš™ï¸ ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ¯ (ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ· Ğ½Ğ° ÑĞ¼ĞµĞ½Ñƒ)",
                    sleeve_label: "ğŸ”§ Ğ’Ğ°Ğ» (ÑĞ¼)",
                    sleeve_placeholder: "59.0",
                    motifs_label: "ğŸ¨ ĞœĞ¾Ñ‚Ğ¸Ğ²Ñ‹",
                    motifs_placeholder: "2",
                    rolls_label: "ğŸ”ª Ğ ÑƒĞ»Ğ¾Ğ½Ğ¾Ğ²",
                    rolls_placeholder: "1",
                    meters_label: "ğŸ“ ĞœĞµÑ‚Ñ€Ñ‹ (Ğ¼)",
                    meters_placeholder: "6289",
                    rounding_label: "ğŸ“ˆ ĞĞºÑ€ÑƒĞ³Ğ»ÑÑ‚ÑŒ Ğ²Ğ²ĞµÑ€Ñ… (Ğ¼Ğ¸Ğ½. +100, Ğ¼Ğ°ĞºÑ. +200)",
                    rounding_desc: "ĞĞºÑ€ÑƒĞ³Ğ»ÑĞµÑ‚ Ğ´Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ ÑĞ¾Ñ‚Ğ½Ğ¸, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 100, Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 200 Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹",
                    result_label_single: "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ - 1 Ñ€ÑƒĞ»Ğ¾Ğ½",
                    result_unit: "Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹",
                    copy_button: "ğŸ“‹ Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ (Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹)",
                    calculate_button: "ğŸ”¢ Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ",
                    stats_today: "ğŸ“Š ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ¾Ğ²",
                    stats_total_images: "ğŸ¯ Ğ’ÑĞµĞ³Ğ¾ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹",
                    stats_avg_roll: "ğŸ“ Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€ÑƒĞ»Ğ¾Ğ½",
                    history_title: "ğŸ“œ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ¾Ğ²",
                    clear_history_button: "ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ",
                    empty_history: "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ¾Ğ² Ğ¿ÑƒÑÑ‚Ğ°. Ğ¡Ğ´ĞµĞ»Ğ°Ğ¹Ñ‚Ğµ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚!",
                    history_delete_button: "ğŸ—‘ï¸ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ",
                    history_meters: "<strong>ĞœĞµÑ‚Ñ€Ñ‹:</strong>",
                    history_sleeve: "<strong>Ğ’Ğ°Ğ»:</strong>",
                    history_motifs: "<strong>ĞœĞ¾Ñ‚Ğ¸Ğ²Ñ‹:</strong>",
                    history_rolls: "<strong>Ğ ÑƒĞ»Ğ¾Ğ½Ğ¾Ğ²:</strong>",
                    history_result_label: "â¡ï¸ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:",
                    history_images_unit_single: "Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ (1 Ñ€ÑƒĞ»Ğ¾Ğ½)",
                    history_rounded_from: "ğŸ“ˆ ĞĞºÑ€ÑƒĞ³Ğ»ĞµĞ½Ğ¾ Ñ",
                    history_total_label: "ğŸ”ª Ğ’ÑĞµĞ³Ğ¾:",
                    history_total_images_unit: "Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹",
                    history_total_from_rolls: "Ñ€ÑƒĞ»Ğ¾Ğ½Ğ¾Ğ²",
                    confirm_delete_item: "Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ¾Ñ‚ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ¸Ğ· Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸?",
                    alert_history_empty: "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑƒĞ¶Ğµ Ğ¿ÑƒÑÑ‚Ğ°!",
                    confirm_clear_history: "Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑÑ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ({count} Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ¾Ğ²)?",
                    copied_text: "âœ… Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾:",
                    detailed_result_text: "ğŸ“Š Ğ¢Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: {exact} (+{diff} Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹)",
                    total_result_text: "ğŸ”ª Ğ’ÑĞµĞ³Ğ¾ {rolls} Ñ€ÑƒĞ»Ğ¾Ğ½Ğ¾Ğ²: {total} Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ ({single} Ã— {rolls})",
                    error_invalid_sleeve: "Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ²Ğ°Ğ»Ğ° Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½ÑƒĞ»Ñ!"
                }
            },

            currentLang: 'pl',
            history: [],
            lastResult: 0,

            setLanguage(lang) {
                if (!this.translations[lang]) return;
                this.currentLang = lang;
                localStorage.setItem('obrazki_language', lang);

                document.querySelectorAll('[data-translate-key]').forEach(el => {
                    const key = el.dataset.translateKey;
                    if (this.translations[lang][key]) {
                        el.innerHTML = this.translations[lang][key];
                    }
                });

                document.querySelectorAll('[data-translate-title-key]').forEach(el => {
                    const key = el.dataset.translateTitleKey;
                    if (this.translations[lang][key]) {
                        el.title = this.translations[lang][key];
                    }
                });

                document.querySelectorAll('[data-translate-placeholder-key]').forEach(el => {
                    const key = el.dataset.translatePlaceholderKey;
                    if (this.translations[lang][key]) {
                        el.placeholder = this.translations[lang][key];
                    }
                });

                document.querySelectorAll('.lang-flag').forEach(flag => {
                    flag.classList.toggle('active', flag.dataset.lang === lang);
                });

                this.renderHistory();

                const resultBox = document.getElementById('resultBoxObrazki');
                if (resultBox.style.display === 'block' && this.history.length > 0) {
                    const lastCalc = this.history[0];
                    const resultDetails = document.getElementById('resultDetailsObrazki');
                    const resultTotal = document.getElementById('resultTotalObrazki');
                    const resultTotalText = document.getElementById('resultTotalTextObrazki');

                    if (lastCalc.zaokraglono) {
                        const roznica = lastCalc.wynikKoÅ„cowy - lastCalc.wynikDokÅ‚adny;
                        resultDetails.innerHTML = this.translations[this.currentLang].detailed_result_text
                            .replace('{exact}', lastCalc.wynikDokÅ‚adny.toLocaleString('pl-PL'))
                            .replace('{diff}', roznica);
                    } else {
                        resultDetails.innerHTML = '';
                    }

                    if (lastCalc.rolki > 1) {
                        resultTotal.style.display = 'block';
                        resultTotalText.textContent = this.translations[this.currentLang].total_result_text
                            .replace(/{rolls}/g, lastCalc.rolki)
                            .replace('{total}', lastCalc.wynikLacznie.toLocaleString('pl-PL'))
                            .replace('{single}', lastCalc.wynikKoÅ„cowy.toLocaleString('pl-PL'));
                    } else {
                        resultTotal.style.display = 'none';
                    }
                }
            },

            loadLanguage() {
                const savedLang = localStorage.getItem('obrazki_language');
                if (savedLang && this.translations[savedLang]) {
                    this.setLanguage(savedLang);
                } else {
                    this.setLanguage('pl');
                }
            },

            loadHistory() {
                const saved = localStorage.getItem('obrazki_history');
                if (saved) {
                    try {
                        this.history = JSON.parse(saved);
                        this.renderHistory();
                    } catch (e) {
                        console.error('BÅ‚Ä…d wczytywania historii:', e);
                        this.history = [];
                    }
                }
            },

            saveHistory() {
                localStorage.setItem('obrazki_history', JSON.stringify(this.history));
            },

            calculate(event) {
                event.preventDefault();

                const metry = parseFloat(document.getElementById('metryObrazki').value);
                const walek = parseFloat(document.getElementById('walekObrazki').value);
                const motywy = parseInt(document.getElementById('motywyObrazki').value);
                const zaokraglaj = document.getElementById('zaokraglajObrazki').checked;
                const rolki = parseInt(document.getElementById('rolkiObrazki').value) || 1;

                if (walek <= 0) {
                    alert(this.translations[this.currentLang].error_invalid_sleeve);
                    return;
                }

                const wynikDokÅ‚adny = Math.floor(((metry / walek) * 100) * motywy);
                let wynikKoÅ„cowy = wynikDokÅ‚adny;
                let zaokraglono = false;

                if (zaokraglaj) {
                    const doDodania = 100 + (100 - (wynikDokÅ‚adny % 100)) % 100;
                    wynikKoÅ„cowy = wynikDokÅ‚adny + doDodania;
                    zaokraglono = true;
                }

                this.lastResult = wynikKoÅ„cowy;
                const wynikLacznie = wynikKoÅ„cowy * rolki;

                const resultBox = document.getElementById('resultBoxObrazki');
                const resultValue = document.getElementById('resultValueObrazki');
                const resultDetails = document.getElementById('resultDetailsObrazki');
                const resultTotal = document.getElementById('resultTotalObrazki');

                resultBox.style.display = 'block';
                resultValue.textContent = wynikKoÅ„cowy.toLocaleString('pl-PL');

                if (zaokraglono) {
                    const roznica = wynikKoÅ„cowy - wynikDokÅ‚adny;
                    resultDetails.innerHTML = this.translations[this.currentLang].detailed_result_text
                        .replace('{exact}', wynikDokÅ‚adny.toLocaleString('pl-PL'))
                        .replace('{diff}', roznica);
                } else {
                    resultDetails.innerHTML = '';
                }

                if (rolki > 1) {
                    resultTotal.style.display = 'block';
                    document.getElementById('resultTotalTextObrazki').textContent = this.translations[this.currentLang].total_result_text
                        .replace(/{rolls}/g, rolki)
                        .replace('{total}', wynikLacznie.toLocaleString('pl-PL'))
                        .replace('{single}', wynikKoÅ„cowy.toLocaleString('pl-PL'));
                } else {
                    resultTotal.style.display = 'none';
                }

                resultValue.style.transform = 'scale(0)';
                setTimeout(() => {
                    resultValue.style.transition = 'transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                    resultValue.style.transform = 'scale(1)';
                }, 10);

                const historyItem = {
                    id: Date.now(),
                    metry, walek, motywy, rolki, wynikDokÅ‚adny, wynikKoÅ„cowy, wynikLacznie, zaokraglono,
                    timestamp: new Date().toLocaleString('pl-PL', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' })
                };

                this.history.unshift(historyItem);
                if (this.history.length > 50) this.history = this.history.slice(0, 50);

                this.saveHistory();
                this.renderHistory();
                this.updateStats();
            },

            copyResult(event) {
                const formatted = (this.lastResult / 1000).toFixed(1);

                // Copy to clipboard
                navigator.clipboard.writeText(formatted).then(() => {
                    const btn = event.target.closest('.btn');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = `${this.translations[this.currentLang].copied_text} ${formatted}`;
                    btn.style.background = 'rgba(76, 175, 80, 0.3)';
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.style.background = 'rgba(255,255,255,0.2)';
                    }, 2000);

                    // AUTO-INSERT INTO ROLKI APP AND SWITCH TAB
                    // Convert format: if result is 25.5, insert 25500 (multiply by 1000)
                    const valueForRolki = this.lastResult;
                    document.getElementById('imagesRolki').value = valueForRolki;

                    // Switch to Rolki tab
                    setTimeout(() => {
                        document.querySelector('.tab-button.active').classList.remove('active');
                        document.querySelectorAll('.tab-button')[1].classList.add('active');
                        document.getElementById('obrazkiTab').classList.remove('active');
                        document.getElementById('rolkiTab').classList.add('active');
                        currentTab = 'rolki';
                        document.getElementById('languageSelectorObrazki').style.display = 'none';
                        document.getElementById('helpButtonObrazki').style.display = 'none';

                        // Focus on the WEIGHT field (not images) so user can immediately enter weight
                        document.getElementById('weightRolki').focus();
                    }, 500);
                }).catch(err => console.error('BÅ‚Ä…d kopiowania:', err));
            },

            renderHistory() {
                const container = document.getElementById('historyContainerObrazki');
                const langDict = this.translations[this.currentLang];

                if (this.history.length === 0) {
                    container.innerHTML = `<div class="empty-history">${langDict.empty_history}</div>`;
                    return;
                }

                container.innerHTML = this.history.map(item => {
                    const wynikDoWyswietlenia = item.wynikKoÅ„cowy || item.wynik;
                    let wynikHTML = '';

                    if (item.zaokraglono) {
                        const roznica = item.wynikKoÅ„cowy - item.wynikDokÅ‚adny;
                        wynikHTML = `
                            <div class="history-result">
                                ${langDict.history_result_label} ${wynikDoWyswietlenia.toLocaleString('pl-PL')} ${langDict.history_images_unit_single}
                                <span style="font-size: 0.9rem; opacity: 0.7; display: block; margin-top: 0.3rem;">
                                   ${langDict.history_rounded_from} ${item.wynikDokÅ‚adny.toLocaleString('pl-PL')} (+${roznica})
                                </span>
                            </div>`;
                    } else {
                        wynikHTML = `<div class="history-result">${langDict.history_result_label} ${wynikDoWyswietlenia.toLocaleString('pl-PL')} ${langDict.history_images_unit_single}</div>`;
                    }

                    if (item.rolki > 1) {
                        wynikHTML += `
                            <div style="margin-top: 0.8rem; padding: 0.8rem; background: rgba(76, 175, 80, 0.1); border-radius: 5px; border-left: 3px solid #4caf50;">
                                <strong style="color: #4caf50;">${langDict.history_total_label} ${item.wynikLacznie.toLocaleString('pl-PL')} ${langDict.history_total_images_unit}</strong>
                                <span style="font-size: 0.9rem; color: var(--text-secondary); display: block; margin-top: 0.2rem;">
                                    (${wynikDoWyswietlenia.toLocaleString('pl-PL')} Ã— ${item.rolki} ${langDict.history_total_from_rolls})
                                </span>
                            </div>`;
                    }

                    return `
                        <div class="history-item">
                            <div class="history-item-header">
                                <div class="history-item-time">ğŸ“… ${item.timestamp}</div>
                                <button class="history-item-delete" onclick="ObrazkiApp.deleteHistoryItem(${item.id})">${langDict.history_delete_button}</button>
                            </div>
                            <div class="history-item-data">
                                <div class="history-data-item">${langDict.history_meters} ${item.metry.toLocaleString('pl-PL')} m</div>
                                <div class="history-data-item">${langDict.history_sleeve} ${item.walek} cm</div>
                                <div class="history-data-item">${langDict.history_motifs} ${item.motywy}</div>
                                ${item.rolki > 1 ? `<div class="history-data-item">${langDict.history_rolls} ${item.rolki}</div>` : ''}
                            </div>
                            ${wynikHTML}
                        </div>`;
                }).join('');
            },

            updateStats() {
                const statToday = this.history.length;
                const statTotal = this.history.reduce((sum, item) => sum + (item.wynikLacznie || item.wynikKoÅ„cowy || item.wynik || 0), 0);
                const statAvg = this.history.length > 0 ? Math.round(this.history.reduce((sum, item) => sum + item.metry, 0) / this.history.length) : 0;

                document.getElementById('statTodayObrazki').textContent = statToday;
                document.getElementById('statTotalObrazki').textContent = statTotal.toLocaleString('pl-PL');
                document.getElementById('statAvgObrazki').textContent = statAvg.toLocaleString('pl-PL') + ' m';
            },

            deleteHistoryItem(id) {
                if (confirm(this.translations[this.currentLang].confirm_delete_item)) {
                    this.history = this.history.filter(item => item.id !== id);
                    this.saveHistory();
                    this.renderHistory();
                    this.updateStats();
                }
            },

            clearHistory() {
                if (this.history.length === 0) {
                    alert(this.translations[this.currentLang].alert_history_empty);
                    return;
                }

                const confirmMsg = this.translations[this.currentLang].confirm_clear_history.replace('{count}', this.history.length);
                if (confirm(confirmMsg)) {
                    this.history = [];
                    this.saveHistory();
                    this.renderHistory();
                    this.updateStats();
                    document.getElementById('resultBoxObrazki').style.display = 'none';
                    document.getElementById('calculatorFormObrazki').reset();
                    document.getElementById('rolkiObrazki').value = 1;
                }
            }
        };

        function toggleHelpObrazki() {
            const helpBox = document.getElementById('helpBoxObrazki');
            helpBox.style.display = (helpBox.style.display === 'none' || helpBox.style.display === '') ? 'block' : 'none';
        }

        // =================================================================
        // ROLKI APP
        // =================================================================
        class RollTracker {
            constructor() {
                this.rolls = this.loadFromStorage();
                this.palletCustomSizes = this.loadPalletSizes();
                this.currentEditingPalletIndex = null;
                this.initElements();
                this.attachEventListeners();
                this.render();
            }

            initElements() {
                this.form = document.getElementById('addRollFormRolki');
                this.weightInput = document.getElementById('weightRolki');
                this.imagesInput = document.getElementById('imagesRolki');
                this.quantityInput = document.getElementById('quantityRolki');
                this.rollsPerPalletInput = document.getElementById('rollsPerPalletRolki');
                this.continuationMode = document.getElementById('continuationModeRolki');
                this.lastRollNumber = document.getElementById('lastRollNumberRolki');
                this.lastRollGroup = document.getElementById('lastRollGroupRolki');
                this.rollsList = document.getElementById('rollsListRolki');
                this.totalPallets = document.getElementById('totalPalletsRolki');
                this.totalRolls = document.getElementById('totalRollsRolki');
                this.totalWeight = document.getElementById('totalWeightRolki');
                this.totalImages = document.getElementById('totalImagesRolki');
                this.clearAllBtn = document.getElementById('clearAllBtnRolki');

                this.editPalletModal = document.getElementById('editPalletModalRolki');
                this.editRollsPerPallet = document.getElementById('editRollsPerPalletRolki');
                this.modalPalletInfo = document.getElementById('modalPalletInfoRolki');
                this.cancelEditBtn = document.getElementById('cancelEditBtnRolki');
                this.saveEditBtn = document.getElementById('saveEditBtnRolki');

                this.loadContinuationSettings();
                this.loadPalletSettings();
            }

            attachEventListeners() {
                this.form.addEventListener('submit', (e) => this.handleSubmit(e));
                this.clearAllBtn.addEventListener('click', () => this.clearAll());
                this.continuationMode.addEventListener('change', (e) => this.handleContinuationToggle(e));
                this.lastRollNumber.addEventListener('change', () => this.saveContinuationSettings());
                this.rollsPerPalletInput.addEventListener('change', () => this.savePalletSettings());

                this.cancelEditBtn.addEventListener('click', () => this.closeEditModal());
                this.saveEditBtn.addEventListener('click', () => this.saveEditPallet());
                this.editPalletModal.addEventListener('click', (e) => {
                    if (e.target === this.editPalletModal) {
                        this.closeEditModal();
                    }
                });
            }

            handleContinuationToggle(e) {
                if (e.target.checked) {
                    this.lastRollGroup.style.display = 'block';
                } else {
                    this.lastRollGroup.style.display = 'none';
                }
                this.saveContinuationSettings();
                this.render();
            }

            saveContinuationSettings() {
                const settings = {
                    isContinuation: this.continuationMode.checked,
                    lastRollNumber: parseInt(this.lastRollNumber.value) || 0
                };
                localStorage.setItem('rolki_continuationSettings', JSON.stringify(settings));
            }

            loadContinuationSettings() {
                try {
                    const settings = JSON.parse(localStorage.getItem('rolki_continuationSettings'));
                    if (settings) {
                        this.continuationMode.checked = settings.isContinuation;
                        this.lastRollNumber.value = settings.lastRollNumber;
                        if (settings.isContinuation) {
                            this.lastRollGroup.style.display = 'block';
                        }
                    }
                } catch (e) {
                    console.error('BÅ‚Ä…d wczytywania ustawieÅ„ kontynuacji:', e);
                }
            }

            savePalletSettings() {
                const settings = {
                    rollsPerPallet: parseInt(this.rollsPerPalletInput.value) || 3
                };
                localStorage.setItem('rolki_palletSettings', JSON.stringify(settings));
                this.render();
            }

            loadPalletSettings() {
                try {
                    const settings = JSON.parse(localStorage.getItem('rolki_palletSettings'));
                    if (settings) {
                        this.rollsPerPalletInput.value = settings.rollsPerPallet;
                    }
                } catch (e) {
                    console.error('BÅ‚Ä…d wczytywania ustawieÅ„ palet:', e);
                }
            }

            loadPalletSizes() {
                try {
                    const sizes = localStorage.getItem('rolki_palletCustomSizes');
                    return sizes ? JSON.parse(sizes) : {};
                } catch (e) {
                    console.error('BÅ‚Ä…d wczytywania rozmiarÃ³w palet:', e);
                    return {};
                }
            }

            savePalletSizes() {
                try {
                    localStorage.setItem('rolki_palletCustomSizes', JSON.stringify(this.palletCustomSizes));
                } catch (e) {
                    console.error('BÅ‚Ä…d zapisu rozmiarÃ³w palet:', e);
                }
            }

            handleSubmit(e) {
                e.preventDefault();

                const weight = parseFloat(this.weightInput.value);
                const images = parseInt(this.imagesInput.value) || 0;
                const quantity = parseInt(this.quantityInput.value) || 1;

                if (!weight || weight <= 0) {
                    alert('ProszÄ™ wprowadziÄ‡ prawidÅ‚owÄ… wagÄ™');
                    return;
                }

                if (quantity <= 0) {
                    alert('IloÅ›Ä‡ rolek musi byÄ‡ wiÄ™ksza niÅ¼ 0');
                    return;
                }

                for (let i = 0; i < quantity; i++) {
                    this.addRoll(weight, images);
                }

                this.weightInput.value = '';
                this.imagesInput.value = '';
                this.weightInput.focus();

                this.saveToStorage();
                this.render();
            }

            addRoll(weight, images) {
                const roll = {
                    id: Date.now() + Math.random(),
                    weight: weight,
                    images: images,
                    timestamp: new Date().toISOString()
                };
                this.rolls.push(roll);
            }

            deleteRoll(id) {
                if (confirm('Czy na pewno chcesz usunÄ…Ä‡ tÄ™ rolkÄ™?')) {
                    this.rolls = this.rolls.filter(roll => roll.id !== id);
                    this.saveToStorage();
                    this.render();
                }
            }

            clearAll() {
                if (confirm('Czy na pewno chcesz usunÄ…Ä‡ wszystkie rolki? Tej operacji nie moÅ¼na cofnÄ…Ä‡.')) {
                    this.rolls = [];
                    this.palletCustomSizes = {};
                    this.saveToStorage();
                    this.savePalletSizes();
                    this.render();
                }
            }

            openEditPalletModal(palletIndex, currentSize) {
                this.currentEditingPalletIndex = palletIndex;
                this.editRollsPerPallet.value = currentSize;
                this.modalPalletInfo.textContent = `Paleta #${palletIndex + 1} (obecnie ${currentSize} rolek)`;
                this.editPalletModal.classList.add('show');
            }

            closeEditModal() {
                this.editPalletModal.classList.remove('show');
                this.currentEditingPalletIndex = null;
            }

            saveEditPallet() {
                const newSize = parseInt(this.editRollsPerPallet.value);
                if (!newSize || newSize < 1) {
                    alert('Liczba rolek musi byÄ‡ wiÄ™ksza niÅ¼ 0');
                    return;
                }

                this.palletCustomSizes[this.currentEditingPalletIndex] = newSize;
                this.savePalletSizes();
                this.closeEditModal();
                this.render();
            }

            calculateSummary() {
                const totalRolls = this.rolls.length;
                const totalWeight = this.rolls.reduce((sum, roll) => sum + roll.weight, 0);
                const totalImages = this.rolls.reduce((sum, roll) => sum + roll.images, 0);

                const pallets = this.groupIntoPallets();
                const totalPallets = pallets.length;

                return { totalRolls, totalWeight, totalImages, totalPallets };
            }

            groupIntoPallets() {
                if (this.rolls.length === 0) return [];

                const sortedRolls = [...this.rolls].sort((a, b) =>
                    new Date(a.timestamp) - new Date(b.timestamp)
                );

                const defaultRollsPerPallet = parseInt(this.rollsPerPalletInput.value) || 3;
                const pallets = [];
                let currentPalletIndex = 0;
                let rollIndex = 0;

                while (rollIndex < sortedRolls.length) {
                    const palletSize = this.palletCustomSizes[currentPalletIndex] || defaultRollsPerPallet;
                    const palletRolls = sortedRolls.slice(rollIndex, rollIndex + palletSize);

                    if (palletRolls.length > 0) {
                        pallets.push({
                            index: currentPalletIndex,
                            rolls: palletRolls,
                            size: palletSize
                        });
                    }

                    rollIndex += palletSize;
                    currentPalletIndex++;
                }

                return pallets;
            }

            render() {
                const { totalRolls, totalWeight, totalImages, totalPallets } = this.calculateSummary();
                this.totalPallets.textContent = totalPallets;
                this.totalRolls.textContent = totalRolls;
                this.totalWeight.textContent = totalWeight.toFixed(2);
                this.totalImages.textContent = totalImages;

                if (totalRolls > 0) {
                    this.clearAllBtn.style.display = 'block';
                } else {
                    this.clearAllBtn.style.display = 'none';
                }

                if (this.rolls.length === 0) {
                    this.rollsList.innerHTML = '<p class="empty-message">Brak rolek. Dodaj pierwszÄ… rolkÄ™ powyÅ¼ej.</p>';
                    return;
                }

                const pallets = this.groupIntoPallets();

                const isContinuation = this.continuationMode.checked;
                const lastRoll = parseInt(this.lastRollNumber.value) || 0;

                let globalRollIndex = 0;
                pallets.forEach(pallet => {
                    pallet.rolls = pallet.rolls.map(roll => {
                        const shiftNumber = globalRollIndex + 1;
                        const orderNumber = isContinuation ? lastRoll + globalRollIndex + 1 : globalRollIndex + 1;
                        globalRollIndex++;

                        return {
                            ...roll,
                            shiftNumber: shiftNumber,
                            orderNumber: orderNumber,
                            isContinuation: isContinuation
                        };
                    });
                });

                const palletsForDisplay = [...pallets].reverse();

                this.rollsList.innerHTML = palletsForDisplay.map(pallet => this.createPalletElement(pallet)).join('');

                this.rollsList.querySelectorAll('.btn-delete').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseFloat(e.target.dataset.id);
                        this.deleteRoll(id);
                    });
                });

                this.rollsList.querySelectorAll('.btn-edit-pallet').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const palletIndex = parseInt(e.target.dataset.palletIndex);
                        const currentSize = parseInt(e.target.dataset.currentSize);
                        this.openEditPalletModal(palletIndex, currentSize);
                    });
                });
            }

            createPalletElement(pallet) {
                const palletWeight = pallet.rolls.reduce((sum, roll) => sum + roll.weight, 0);
                const palletImages = pallet.rolls.reduce((sum, roll) => sum + roll.images, 0);

                // OdwrÃ³Ä‡ kolejnoÅ›Ä‡ rolek w palecie - najnowsze na gÃ³rze
                const reversedRolls = [...pallet.rolls].reverse();
                const rollsHtml = reversedRolls.map(roll => this.createRollElement(roll)).join('');

                return `
                    <div class="pallet-container">
                        <div class="pallet-header">
                            <div>
                                <div class="pallet-title">
                                    <span class="pallet-icon">ğŸ“¦</span>
                                    <span>Paleta #${pallet.index + 1}</span>
                                </div>
                                <div class="pallet-summary">
                                    <div class="pallet-stat">
                                        <span>Rolek: <strong>${pallet.rolls.length}</strong></span>
                                    </div>
                                    <div class="pallet-stat">
                                        <span>Waga: <strong>${palletWeight.toFixed(2)} kg</strong></span>
                                    </div>
                                    ${palletImages > 0 ? `
                                        <div class="pallet-stat">
                                            <span>Obrazki: <strong>${palletImages}</strong></span>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="pallet-actions">
                                <button
                                    class="btn-edit-pallet"
                                    data-pallet-index="${pallet.index}"
                                    data-current-size="${pallet.rolls.length}">
                                    Edytuj
                                </button>
                            </div>
                        </div>
                        <div class="pallet-rolls">
                            ${rollsHtml}
                        </div>
                    </div>
                `;
            }

            createRollElement(roll) {
                const date = new Date(roll.timestamp);
                const timeString = date.toLocaleTimeString('pl-PL', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                let rollNumberText;
                if (roll.isContinuation) {
                    rollNumberText = `
                        <div class="roll-number-dual">
                            <span class="order-number">Rolka (zlecenie): #${roll.orderNumber}</span>
                            <span class="shift-number">Rolka (zmiana): #${roll.shiftNumber}</span>
                        </div>
                    `;
                } else {
                    rollNumberText = `<div class="roll-number">Rolka #${roll.orderNumber}</div>`;
                }

                return `
                    <div class="roll-item">
                        <div class="roll-info">
                            ${rollNumberText}
                            <div class="roll-details">
                                <div class="roll-detail">
                                    <strong>Waga:</strong> ${roll.weight.toFixed(2)} kg
                                </div>
                                ${roll.images > 0 ? `
                                    <div class="roll-detail">
                                        <strong>Obrazki:</strong> ${roll.images}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="roll-time">Dodano: ${timeString}</div>
                        </div>
                        <div class="roll-actions">
                            <button class="btn-delete" data-id="${roll.id}">
                                UsuÅ„
                            </button>
                        </div>
                    </div>
                `;
            }

            saveToStorage() {
                try {
                    localStorage.setItem('rolki_rollTrackerData', JSON.stringify(this.rolls));
                } catch (e) {
                    console.error('BÅ‚Ä…d zapisu do localStorage:', e);
                    alert('Nie udaÅ‚o siÄ™ zapisaÄ‡ danych. SprawdÅº ustawienia przeglÄ…darki.');
                }
            }

            loadFromStorage() {
                try {
                    const data = localStorage.getItem('rolki_rollTrackerData');
                    return data ? JSON.parse(data) : [];
                } catch (e) {
                    console.error('BÅ‚Ä…d odczytu z localStorage:', e);
                    return [];
                }
            }
        }

        // =================================================================
        // INITIALIZATION
        // =================================================================
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadCurrentTab();
            ObrazkiApp.loadHistory();
            ObrazkiApp.loadLanguage();
            ObrazkiApp.updateStats();
            new RollTracker();
        });
    </script>
</body>
</html>
